PREFIX ihr: <http://pcai042.informatik.uni-leipzig.de/~swp15-ihr/leipzighaushalt#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX xsd:<http://www.w3.org/2001/XMLSchema#> PREFIX qb: <http://purl.org/linked-data/cube#>

SELECT  DISTINCT ?prBerNummer  ?prGrNummer ?prUGrNummer ?bezugNummer  SUM(xsd:decimal(?ein)) ?label
                             WHERE { {?x ihr:kategorie ihr:Ergebnishaushalt;
                                        ihr:prBerNummer ?prBerNummer;
                                        ihr:prGrNummer ?prGrNummer; 
                                        ihr:prUGrNummer ?prUGrNummer;
                                        ihr:bezugNummer ?bezugNummer; ihr:ein ?ein.
                                        ?bezugNummer rdfs:label ?label.
                                        FILTER regex(?label, "Ordnung").}
                                    UNION {
                                       {?y ihr:kategorie ihr:Ergebnishaushalt;
                                        ihr:prBerNummer ?prBerNummer; ihr:ein ?ein.
                                        ?prBerNummer rdfs:label ?label .
                                        FILTER regex(?label, "Ordnung").}
                                      }
                                    UNION {
                                       {?z ihr:kategorie ihr:Ergebnishaushalt;
                                        ihr:prBerNummer ?prBerNummer;
                                        ihr:prGrNummer ?prGrNummer; ihr:ein ?ein.
                                        ?prGrNummer rdfs:label ?label .
                                        FILTER regex(?label, "Ordnung").}
                                      }
                                   UNION {
                                       {?w ihr:kategorie ihr:Ergebnishaushalt;
                                         ihr:prBerNummer ?prBerNummer;
                                        ihr:prGrNummer ?prGrNummer;
                                        ihr:prUGrNummer ?prUGrNummer; ihr:ein ?ein.
                                        ?prUGrNummer rdfs:label ?label .
                                        FILTER regex(?label, "Ordnung").}
                                      }
                                     
                             }
                          GROUP BY ?prUGrNummer ?prBerNummer ?prGrNummer ?bezugNummer ?label
                          HAVING (SUM(xsd:decimal(?ein)) != 0)
                          ORDER BY ?label
                       

